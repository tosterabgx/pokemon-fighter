{% extends "base.html" %}

{% block title %}Table{% endblock %}

{% block content %}
<div class="rounded-lg bg-gray-100 p-2 m-10 shadow-md">
  <table class="w-full border border-gray-300 text-center bg-white">
    <thead class="bg-gray-100">
      <tr>
        <th class="border border-gray-300 px-4 py-2">Username</th>
        {% for u in usernames.values() %}
        <td class="border border-gray-300 px-4 py-2">{{ u }}</td>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for id, u in usernames.items() %}
      <tr>
        <th class="border border-gray-300 px-4 py-2 font-medium bg-gray-100">{{ u }}</th>
        {% for oid, r in results.items() %}
        {% if id|string in r[1].keys() %}
        <td class="border border-gray-300 px-4 py-2 bg-green-300">
          {{ r[1][id|string][::-1] }}
        </td>
        {% elif id|string in r[0].keys() %}
        <td class="border border-gray-300 px-4 py-2 bg-red-300">
          {{ r[0][id|string][::-1] }}
        </td>
        {% elif oid == id %}
        <td class="border border-gray-300 px-4 py-2 bg-gray-50">â€“</td>
        {% else %}
        <td class="border border-gray-300 px-4 py-2 bg-gray-50"> {{ default_value }} </td>
        {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  setInterval(() => {
    fetch("/api/check_update")
      .then(response => response.json())
      .then(data => {
        if (data.update) {
          location.reload();
        }
      })
      .catch(error => console.error("Error checking for updates:", error));
  }, 2000);
</script>
{% endblock %}