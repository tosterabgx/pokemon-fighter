{% extends "base.html" %}

{% block title %}Table{% endblock %}

{% block content %}
<div class="rounded-lg bg-gray-100 p-2 m-10 shadow-md">
  <table class="w-full border border-gray-300 text-center bg-white">
    <thead class="bg-gray-100">
      <tr>
        <th class="border border-gray-300 px-4 py-2">Username</th>
        {% for id, _ in results %}
        <td class="border border-gray-300 px-4 py-2">{{ usernames[id] }}</td>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for id, _ in results %}
      <tr>
        <th class="border border-gray-300 px-4 py-2 font-medium bg-gray-100">{{ usernames[id] }}</th>
        {% for other_id, other_r in results %}
        {% if id in other_r[1].keys() %}
        <td class="border border-gray-300 px-4 py-2 bg-green-300">
          {{ other_r[1][id][::-1] }}
        </td>
        {% elif id in other_r[0].keys() %}
        <td class="border border-gray-300 px-4 py-2 bg-red-300">
          {{ other_r[0][id][::-1] }}
        </td>
        {% elif id in other_r[2].keys() %}
        <td class="border border-gray-300 px-4 py-2 bg-gray-50">{{ other_r[2][id][::-1] }}</td>
        {% else %}
        <td class="border border-gray-300 px-4 py-2 bg-gray-50">-</td>
        {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  setInterval(() => {
    fetch("/api/check_update")
      .then(response => response.json())
      .then(data => {
        if (data.update) {
          location.reload();
        }
      })
      .catch(error => console.error("Error checking for updates:", error));
  }, 1000);
</script>
{% endblock %}